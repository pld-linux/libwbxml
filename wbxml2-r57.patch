Index: /wbxml2/trunk/ChangeLog
===================================================================
--- /wbxml2/trunk/ChangeLog (revision 31)
+++ /wbxml2/trunk/ChangeLog (revision 57)
@@ -1,2 +1,6 @@
+2008-02-28  Aymerick Jehanne <aymerick@jehanne.org>
+  * Applied wbxml-svn-r53-anonymous.patch from synce project:
+    https://synce.svn.sourceforge.net/svnroot/synce/trunk/patches/
+
 2006-07-10  Aymerick Jehanne <aymerick@jehanne.org>
   * New release: 0.9.2
Index: /wbxml2/trunk/src/wbxml_tree.c
===================================================================
--- /wbxml2/trunk/src/wbxml_tree.c (revision 49)
+++ /wbxml2/trunk/src/wbxml_tree.c (revision 57)
@@ -138,4 +138,7 @@
         /* Use String Table */
         wbxml_encoder_set_use_strtbl(wbxml_encoder, TRUE);
+        
+        /* Don't produce an anonymous document by default */
+        wbxml_encoder_set_produce_anonymous(wbxml_encoder, FALSE);
     }
     else {
@@ -154,4 +157,7 @@
         /* String Table */
         wbxml_encoder_set_use_strtbl(wbxml_encoder, params->use_strtbl);
+        
+        /* Produce an anonymous document? */
+        wbxml_encoder_set_produce_anonymous(wbxml_encoder, params->produce_anonymous);
 
         /** @todo Add parameter to call : wbxml_encoder_set_output_charset() */
Index: /wbxml2/trunk/src/wbxml.h
===================================================================
--- /wbxml2/trunk/src/wbxml.h (revision 27)
+++ /wbxml2/trunk/src/wbxml.h (revision 57)
@@ -286,4 +286,5 @@
     WB_BOOL keep_ignorable_ws;  /**< Keep Ignorable Whitespaces (Default: FALSE) */
     WB_BOOL use_strtbl;         /**< Generate String Table (Default: TRUE) */
+    WB_BOOL produce_anonymous;  /**< Produce an anonymous document (Default: FALSE) */
 } WBXMLGenWBXMLParams;
 
Index: /wbxml2/trunk/src/wbxml_encoder.c
===================================================================
--- /wbxml2/trunk/src/wbxml_encoder.c (revision 48)
+++ /wbxml2/trunk/src/wbxml_encoder.c (revision 57)
@@ -159,4 +159,5 @@
 #endif /* WBXML_ENCODER_USE_STRTBL */
     WB_BOOL xml_encode_header;              /**< Do we generate XML Header ? */
+    WB_BOOL produce_anonymous;              /**< Do we produce anonymous documents? (default: NO) */
     WBXMLVersion wbxml_version;             /**< WBXML Version to use (when generating WBXML output) */
     WBXMLCharsetMIBEnum output_charset;     /**< Output charset encoding */
@@ -412,4 +413,5 @@
 
     encoder->xml_encode_header = TRUE;
+    encoder->produce_anonymous = FALSE;
 
     /* Default Version: WBXML 1.3 */
@@ -519,4 +521,13 @@
     encoder->use_strtbl = use_strtbl;
 #endif /* WBXML_ENCODER_USE_STRTBL */
+}
+
+
+WBXML_DECLARE(void) wbxml_encoder_set_produce_anonymous(WBXMLEncoder *encoder, WB_BOOL set_anonymous)
+{
+    if (encoder == NULL)
+        return;
+
+    encoder->produce_anonymous = set_anonymous;
 }
 
@@ -1481,5 +1492,6 @@
     /* Encode Public ID */
     /* If WBXML Public Id is '0x01' (unknown), or we forced it, add the XML Public ID in the String Table */
-    if (encoder->textual_publicid || (public_id == WBXML_PUBLIC_ID_UNKNOWN))
+    if ((encoder->textual_publicid || (public_id == WBXML_PUBLIC_ID_UNKNOWN)) &&
+        !encoder->produce_anonymous)
     {
         if (encoder->lang->publicID->xmlPublicID != NULL)
Index: /wbxml2/trunk/src/wbxml_encoder.h
===================================================================
--- /wbxml2/trunk/src/wbxml_encoder.h (revision 39)
+++ /wbxml2/trunk/src/wbxml_encoder.h (revision 57)
@@ -119,4 +119,11 @@
 
 /**
+ * @brief Set if we want to produce anonymous WBXML documents [Default: FALSE]
+ * @param encoder [in] The WBXML encoder
+ * @param set_anonymous [in] TRUE to produce anonymous documents, FALSE otherwise
+ */
+WBXML_DECLARE(void) wbxml_encoder_set_produce_anonymous(WBXMLEncoder *encoder, WB_BOOL set_anonymous);
+
+/**
  * @brief Set the WBXML Version of the output document, when generating WBXML [Default: 'WBXML_VERSION_TOKEN_13' (1.3)]
  * @param encoder [in] The WBXML Encoder
